<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
</head>
<body>
  <h3>Giroscópio</h3>
  <h3>Valores do giroscópio.</h3>
  <p><span class="leitura">X: <span id="gyroX">0</span></span></p>
  <p><span class="leitura">Y: <span id="gyroY">0</span></span></p>
  <p><span class="leitura">Z: <span id="gyroZ">0</span></span></p>
  <input type="button" onclick="onClick()" value="Iniciar Giroscópio">
  
  <script>
    const gyroData = {
      x: null,
      y: null,
      z: null,
      alpha: null,
      beta: null,
      gamma: null
    };

    function onClick() {
      if (typeof DeviceOrientationEvent.requestPermission === 'function') {
        DeviceOrientationEvent.requestPermission()
          .then(permissionState => {
            if (permissionState === 'granted') {
              window.addEventListener('deviceorientation', cb);
            }
          })
          .catch(console.error);
      } else {
        window.addEventListener('deviceorientation', cb);
      }
    }

    function cb(event) {
      gyroData.alpha = event.alpha;
      gyroData.beta = event.beta;
      gyroData.gamma = event.gamma;

      document.getElementById('gyroX').textContent = gyroData.alpha.toFixed(3);
      document.getElementById('gyroY').textContent = gyroData.beta.toFixed(3);
      document.getElementById('gyroZ').textContent = gyroData.gamma.toFixed(3);
    }

    function setup() {
      createCanvas(windowWidth, windowHeight);
    }

    function draw() {
      background(255);
      strokeWeight(3);
      rect(100, 100, 200, 200, 20);

      const medidaX = (width / 2) + (gyroData.x * 100);
      const medidaY = (height / 2) + (gyroData.y * 150);

      let xr = constrain(medidaX, 100, 300);
      let yr = constrain(medidaY, 100, 300);

      push();
      fill("black");
      circle(xr, yr, 75);
      textSize(25);
      if (gyroData.y < -0.2) {
        text("FRENTE", 150, 350);
      } else if (gyroData.y > 0.5) {
        text("TRÁS", 150, 350);
      }

      if (gyroData.x < -0.7) {
        text("ESQUERDA", 150, 375);
      } else if (gyroData.x > 0.7) {
        text("DIREITA", 150, 375);
      }
      pop();
    }
  </script>
</body>
</html>