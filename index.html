<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
</head>
<body>
  <h3>Giroscópio</h3>
  <div id="gyro_draw" function="draw()"></div>
  <h3>Valores do giroscópio.</h3>
  <p><span class="leitura">X: <span id="gyroX">0</span></span></p>
  <p><span class="leitura">Y: <span id="gyroY">0</span></span></p>
  <p><span class="leitura">Z: <span id="gyroZ">0</span></span></p>
  <input type="button" onclick="onClick()" value="Iniciar Giroscópio">
  
  <script>
    const gyroData = {
      x: null,
      y: null,
      z: null,
      alpha: null,
      beta: null,
      gamma: null
    };

    function onClick() {
      if (typeof DeviceOrientationEvent.requestPermission === 'function') {
        DeviceOrientationEvent.requestPermission()
          .then(permissionState => {
            if (permissionState === 'granted') {
              window.addEventListener('deviceorientation', cb);
            }
          })
          .catch(console.error);
      } else {
        window.addEventListener('deviceorientation', cb);
      }
    }

    function cb(event) {
      gyroData.alpha = event.alpha;
      gyroData.beta = event.beta;
      gyroData.gamma = event.gamma;



      gyroData.x =gyroData.beta/100;
      gyroData.y =gyroData.gamma/100;
      gyroData.z =gyroData.alpha/100;


      document.getElementById('gyroX').textContent = gyroData.x.toFixed(3);
      document.getElementById('gyroY').textContent = gyroData.y.toFixed(3);
      document.getElementById('gyroZ').textContent = gyroData.z.toFixed(3);

      
    }

    let q =
      function setup() {
  createCanvas(windowWidth, windowHeight, WEBGL); // Use WEBGL mode for 3D graphics
  background(0);
  directionalLight(255, 255, 255, -1, -1, -1);
  ambientLight(80);
  q = new Quaternion(); // Inicialize a variável q (assumindo que você já a definiu)
}
    

    function draw() {
  background(0);

  let qx = angleAxis(gyroData.x, new vec3(1, 0, 0));
  let qy = angleAxis(gyroData.y, new vec3(0, 1, 0));
  let qz = angleAxis(gyroData.z, new vec3(0, 0, 1));

  // Aplica as rotações
  q = qx.mult(qy).mult(qz).mult(q);

  // Posiciona a câmera para visualização 3D
  camera(0, 0, 500, 0, 0, 0, 0, 1, 0);

  // Desenha o cubo
  rotate(q.getAngle(), q.getAxis().toPV());
  box(100);
}
  </script>
</body>
</html>